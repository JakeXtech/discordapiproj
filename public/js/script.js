//Event listener to run python script and send it data variable / eventually value from 'command-input' field will be
//sent to python script
const generateBtn = document.querySelector("#generate-graphic-btn");
generateBtn.addEventListener("click", function () {
	// let command = document.querySelector("#command-input").value;
	axios
		.post(
			"/runPythonScript"
			// , { command: command }
		)
		.then((response) => console.log(response.data))
		.catch((error) => console.log(error));
});

// function to retrieve the images from the server
// first the event listener in discordbot.js saves the images to the public/botdownloads folder
// then this function retrieves the images from the folder and displays them in the index.handlebars template
function getImages() {
	fetch("/images")
		.then((response) => response.json())
		.then((files) => {
			// filter the files to only get the webp files
			let webpFiles = files.filter((file) => file.endsWith(".webp"));

			// sort the files by their name
			// the most recent image file will be the last in the array, so that will be the one most recently generated by the
			// other Discord server's bot, which will be the response to the text command sent from the client to the python script.
			webpFiles
				.sort((a, b) => {
					return a.localeCompare(b);
				})
				.reverse();

			// update the images in the index.handlebars template
			let imageContainer = document.querySelector(".image-container");
			imageContainer.innerHTML = ""; // empty the container
			let image = document.createElement("img");
			image.src = `/botdownloads/${webpFiles[0]}`;
			imageContainer.appendChild(image);
		})
		.catch((error) => console.log(error));
}

// Keep checking the images folder
// Currently need to refresh the page to load the latest image in /public/botdownloads
setInterval(getImages, 5000);
